{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Browsing History</title>
<link rel="stylesheet" href="{% static 'css/browsing_history_style.css' %}">
<link rel="stylesheet" href="{% static 'css/home_style.css' %}">
</head>
<body>

<header class="navbar">
    <div class="logo">
        <a href="/home/">üåø Skincare</a>
    </div>
    <nav class="nav-links">
        <a href="/category/">Categories</a>
        <a href="/quiz/">Quiz</a>
        <a href="{% url 'routine' %}">My Routine</a>
        {% if user.is_authenticated %}
            <a href="{% url 'profile' %}">Profile</a>
            <a href="{% url 'logout' %}">Logout</a>
        {% else %}
            <a href="{% url 'login' %}">Login</a>
            <a href="{% url 'sign_up' %}">Register</a>
        {% endif %}
    </nav>
    <div class="search-bar">
        <!-- <a href="{% url 'browsing_history' %}" class="btn">üìú History</a> -->
        <form action="/search/" method="get">
            <input type="text" name="q" placeholder="Search products..." />
            <button type="submit">üîç</button>
        </form>
    </div>
</header>

<div class="main-content">
    <h1>Browsing History</h1>
    
    {% if product_histories %}
        <!-- ÿØ⁄©ŸÖŸá Ÿæÿß⁄© ⁄©ÿ±ÿØŸÜ ⁄©ŸÑ ÿ™ÿßÿ±€åÿÆ⁄ÜŸá -->
        <form action="{% url 'clear_browsing_history' %}" method="post" style="margin-bottom: 20px;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Clear history</button>
        </form>
    {% endif %}
    <div class="history-list">
        {% for item in histories_with_time %}
        <div class="history-card">
            {% if item.product.image %}
                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
            {% else %}
                <img src="{% static 'images/no-image.png' %}" alt="No Image">
            {% endif %}
            <h3><a href="{% url 'product_detail' item.product.slug %}">{{ item.product.name }}</a></h3>
            <p class="interaction">
                {% for i in item.interactions %}
                    {{ i|capfirst }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
            <p class="timestamp">
                {{ item.last_view|date:"Y-m-d H:i" }}
            </p>
        </div>
        {% empty %}
        <p>No browsing history yet.</p>
        {% endfor %}
    </div>
</div>

<footer class="footer">
    <p>&copy; 2025 Skincare Platform. All rights reserved.</p>
    <nav class="footer-links">
        <a href="/about/">About Us</a>
        <a href="/contact/">Contact</a>
        <a href="/privacy/">Privacy Policy</a>
    </nav>
</footer>

</body>
</html>
